<!DOCTYPE html>
<html>

	<head>
		
<title>Spring(二)-</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/image/favicon.ico">


<meta name="keywords" content="Spring,service,容器,bean,">
<meta name="description" content="Spring框架是一个集众多设计模式于一身的`开源的`、`轻量级`的`项目管理`框架">


<script src="/js/jquery.min.js"></script>


	<meta name="generator" content="Hexo 5.3.0"></head>

	<body>
		
<link rel="stylesheet" href="/css/page.css">


<link rel="stylesheet" href="/css/page_cente.css">


<link rel="stylesheet" href="/css/atom-one-dark.css">


<link rel="stylesheet" href="/css/header.css">

	<div class="header">
		<div class="header-top">
			<div class="h-left">
				<a href="/">
					<img src="/image/logo.png" alt="Quiet">
				</a>
			</div>
			<div class="h-right">
				<ul>
					
						
								<li>
									<a href="/">
										主页
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/archives">
										文章
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/categories">
										分类
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/tags">
										标签
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/links">
										友情链接
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/about">
										关于
									</a>
									<span class="dot"></span>
								</li>
								
									
				</ul>
			</div>
			<div class="h-right-close">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
					<path fill="none" d="M0 0h24v24H0z" />
					<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
				</svg>
			</div>
		</div>
	</div>
	<div class="sidebar">
    <div class="topo">
        <h2>CHENHUAYI</h2>
    </div>
    <ul>
        
        <li>
            <a href="/">主页</a>
        </li>
        
        <li>
            <a href="/archives">文章</a>
        </li>
        
        <li>
            <a href="/categories">分类</a>
        </li>
        
        <li>
            <a href="/tags">标签</a>
        </li>
        
        <li>
            <a href="/links">友情链接</a>
        </li>
        
        <li>
            <a href="/about">关于</a>
        </li>
        
    </ul>
    <div class="my_foot">
        
        <a target="_blank" rel="noopener" href="https://github.com/yichen199709">
            <img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quiet主题">
        </a>
        
    </div>
</div>
<div class='shelter'
    style='cursor: pointer;display: none; position: fixed;left: 0;top: 0; right: 0;bottom: 0;background-color: #333;opacity:0.3;z-index: 108;'>
</div>
<style>
    .sidebar {
        width: 0;
        height: 100%;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        background: #fff;
        z-index: 999;
        text-align: center;
        box-shadow: -6px 0 20px rgba(98, 94, 94, .815)
    }

    .topo {
        width: 100%;
        height: 200px;
        background: url(https://api.ixiaowai.cn/gqapi/gqapi.php) no-repeat;
        background-size: 100% 100%;
        position: relative;
        display: flex;
        align-items: flex-end
    }

    .topo h2 {
        color: #fff;
        z-index: 1;
        position: relative;
        margin: 0 0 10px 10px;
        font-size: 1.2em;
        box-sizing: border-box
    }

    .topo:before {
        content: '';
        background-image: url(/image/pattern.png);
        background-repeat: repeat;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1
    }

    .sidebar ul {
        width: 100%;
        margin-top: 50px
    }

    .sidebar ul li {
        height: 50px;
        list-style: none;
        font-size: 1.2em;
        text-align: right;
        margin-right: 10px
    }

    .sidebar ul li a {
        display: grid;
        color: #5d606a;
        text-overflow: ellipsis;
        width: 100%;
        text-decoration: none
    }

    .my_foot {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        position: absolute;
        bottom: 0
    }

    .my_foot a {
        text-decoration: none;
        margin-right: 10px;
        display: inline-block
    }

    .my_foot a img {
        width: 30px;
        height: 30px
    }
</style>

<script>
    $(function () { $('.h-right-close>svg').click(function () { $('.sidebar').animate({ width: "66%" }, 500); $('.shelter').fadeIn("slow") }); $('.shelter').click(function (e) { $('.sidebar').animate({ width: "0" }, 500); $('.shelter').fadeOut("slow") }) })
</script>
		<script>
			$(function () { $(window).scroll(function () { if ($(document).scrollTop() > 100) { $(".header-top").removeClass("header-move2"); $('.header-top').addClass('header-move1') } else { $(".header-top").removeClass("header-move1"); $('.header-top').addClass('header-move2') } }) });
		</script>
<div class="header-bg ">
    <div class="bg-content">
        <ul class="tag">
            
            
            <li><a href="/tags/Spring">Spring</a></li>
            
            <li><a href="/tags/service">service</a></li>
            
            <li><a href="/tags/容器">容器</a></li>
            
            <li><a href="/tags/bean">bean</a></li>
            
            
        </ul>
        <h1>Spring(二)</h1>
        <div class="article-info">
            <div class="article-author">
                
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                    <g>
                        <path fill="#12183A"
                            d="M6.187 15.265A6.47 6.47 0 0 0 10 16.5a6.47 6.47 0 0 0 3.813-1.235A4.99 4.99 0 0 0 10 13.5a4.99 4.99 0 0 0-3.813 1.765zM5.082 14.25A6.485 6.485 0 0 1 10 12c1.965 0 3.726.872 4.918 2.25a6.5 6.5 0 1 0-9.836 0zM10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0-1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z">
                        </path>
                    </g>
                </svg>
                
                <span> <a href="">CHENHUAYI</a></span>
                <p>2020-04-10 08:44:33</p>
            </div>
        </div>
    </div>
</div>
<div class="article-content">
    <div id="article" class="content">
        <h1 id="Spring2"><a href="#Spring2" class="headerlink" title="Spring2"></a>Spring2</h1><h2 id="1-现有业务层开发存在问题"><a href="#1-现有业务层开发存在问题" class="headerlink" title="1.现有业务层开发存在问题"></a>1.现有业务层开发存在问题</h2><h3 id="a-定义业务接口"><a href="#a-定义业务接口" class="headerlink" title="a.定义业务接口"></a>a.定义业务接口</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String name)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">findAll</span><span class="hljs-params">(String name)</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">findOne</span><span class="hljs-params">(String id)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="b-实现业务接口"><a href="#b-实现业务接口" class="headerlink" title="b.实现业务接口"></a>b.实现业务接口</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findAll</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findOne</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>问题:从上图中可以看出,现有业务层中<code>控制事务代码出现了大量的冗余</code>,如何解决现有业务层出现的冗余问题?</p>
</blockquote>
<hr>
<h2 id="2-代理引言"><a href="#2-代理引言" class="headerlink" title="2.代理引言"></a>2.代理引言</h2><h3 id="a-什么是代理"><a href="#a-什么是代理" class="headerlink" title="a.什么是代理"></a>a.什么是代理</h3><blockquote>
<p><code>代理</code>: 指的是java中的一种<code>设计模式</code></p>
</blockquote>
<h3 id="b-为什么需要代理"><a href="#b-为什么需要代理" class="headerlink" title="b.为什么需要代理"></a>b.为什么需要代理</h3><blockquote>
<p><code>很多时候除了当前类能够提供的功能外，我们还需要补充一些额外功能。</code></p>
</blockquote>
<h3 id="c-代理的作用"><a href="#c-代理的作用" class="headerlink" title="c.代理的作用"></a>c.代理的作用</h3><blockquote>
<p>代理对象可以在客户和目标对象之间<code>起到中介作用,从而为目标对象增添额外的功能</code>。</p>
</blockquote>
<h3 id="d-代理图例"><a href="#d-代理图例" class="headerlink" title="d.代理图例"></a>d.代理图例</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707104932188.png" alt="image-20190707104932188"></p>
<hr>
<h2 id="3-静态代理的开发"><a href="#3-静态代理的开发" class="headerlink" title="3.静态代理的开发"></a>3.静态代理的开发</h2><blockquote>
<p><code>目标类|对象(target)</code>:被代理类称之为目标类|或者被代理的对象的称之为目标对象<br>        <code>开发代理的原则: 代理类和目标类功能一致且实现相同的接口,同时代理类中依赖于目标类对象</code></p>
</blockquote>
<h3 id="a-开发静态代理类"><a href="#a-开发静态代理类" class="headerlink" title="a.开发静态代理类"></a>a.开发静态代理类</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//静态代理类</span><br><span class="hljs-comment">//开发原则:代理类和目标类实现相同接口,依赖于真正的目标类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceStaticProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-comment">//真正的目标类 //target 原始业务逻辑对象</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserService</span><span class="hljs-params">(UserService userService)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userService = userService;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            userService.save(name);<span class="hljs-comment">//调用真正业务逻辑方法</span><br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            userService.delete(id);<span class="hljs-comment">//调用真正业务逻辑方法</span><br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            userService.update();<span class="hljs-comment">//调用真正业务逻辑方法</span><br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findAll</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            String result = userService.findAll(name);<span class="hljs-comment">//调用真正业务逻辑方法</span><br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findOne</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<br>            <span class="hljs-comment">//调用目标类方法</span><br>            String one = userService.findOne(id);<span class="hljs-comment">//调用真正业务逻辑方法</span><br>            System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<br>            <span class="hljs-keyword">return</span> one;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="b-更改目标实现类"><a href="#b-更改目标实现类" class="headerlink" title="b.更改目标实现类"></a>b.更改目标实现类</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findAll</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findOne</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;处理业务逻辑,调用DAO~~~&quot;</span>);<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="c-配置静态代理类"><a href="#c-配置静态代理类" class="headerlink" title="c.配置静态代理类"></a>c.配置静态代理类</h3><figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置目标类--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;staticproxy.UserServiceImpl&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--配置代理类--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userServiceStaticProxy&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;staticproxy.UserServiceStaticProxy&quot;</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--注入目标对象--&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userService&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<h3 id="d-调用代理方法"><a href="#d-调用代理方法" class="headerlink" title="d.调用代理方法"></a>d.调用代理方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;spring.xml&quot;</span>);<br>UserService userServiceStaticProxy = (UserService) context.getBean(<span class="hljs-string">&quot;userServiceStaticProxy&quot;</span>);<br>userServiceStaticProxy.save(<span class="hljs-string">&quot;小黑&quot;</span>);<br></code></pre></td></tr></table></figure>
<blockquote>
<p>新的问题:<code>往往在开发我们书写的不仅仅是一个业务层,两个业务层,而我们的业务层会有很多,如果为每一个业务层开发一个静态代理类,不仅没有减轻工作量,甚至让我们的工作量多了一倍不止怎么解决以上这个问题呢?</code></p>
<p>解决方案: <code>为业务层在运行过程中动态创建代理类,通过动态代理类去解决我们现有业务层中业务代码冗余的问题</code> .</p>
</blockquote>
<hr>
<h2 id="4-动态代理的原理"><a href="#4-动态代理的原理" class="headerlink" title="4.动态代理的原理"></a>4.动态代理的原理</h2><blockquote>
<p><code>通过jdk提供的Proxy这个类,动态为现有的业务生成代理类</code><br>    参数一:当前线程类加载器<br>    参数二:生成代理类的接口类型<br>    参数三:通过代理类对象调用方法时会优先进入参数三中的invoke方Proxy.newProxyInstance(loader, interfaces, h);//返回值就是动态代理对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestDynamicProxy</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">final</span> UserService userService =  <span class="hljs-keyword">new</span> UserServiceImpl();<br>        <span class="hljs-comment">//参数1:当前线程类加载器</span><br>        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();<br>        <span class="hljs-comment">//参数2:</span><br>        Class[] classes =  <span class="hljs-keyword">new</span> Class[]&#123;UserService.class&#125;;<br>        <span class="hljs-comment">//参数3:</span><br>        UserService userServiceProxy = (UserService) Proxy.newProxyInstance(contextClassLoader, classes, <span class="hljs-keyword">new</span> InvocationHandler() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    System.out.println(<span class="hljs-string">&quot;开启事务&quot;</span>);<span class="hljs-comment">//附加操作</span><br>                    Object invoke = method.invoke(userService, args);<br>                    System.out.println(<span class="hljs-string">&quot;提交事务&quot;</span>);<span class="hljs-comment">//附加操作</span><br>                    <span class="hljs-keyword">return</span> invoke;<br>                &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                    System.out.println(<span class="hljs-string">&quot;回滚事务&quot;</span>);<span class="hljs-comment">//附加操作</span><br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br>        &#125;);<br>        userServiceProxy.save(<span class="hljs-string">&quot;小黑&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="5-AOP-Aspect-Oriented-Programming-编程"><a href="#5-AOP-Aspect-Oriented-Programming-编程" class="headerlink" title="5.AOP (Aspect Oriented Programming)编程"></a>5.AOP (Aspect Oriented Programming)编程</h2><blockquote>
<p><code>通知(Advice)</code>: <code>除了目标方法以外的操作都称之为通知</code><br>        <code>切入点(PointCut): 要为哪些类中的哪些方法加入通知</code><br>        <code>切面(Aspect)</code>: <code>通知 + 切入点</code></p>
</blockquote>
<h3 id="1-通知分类"><a href="#1-通知分类" class="headerlink" title="1.通知分类"></a>1.通知分类</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707180956055.png" alt="image-20190707180956055"></p>
<h3 id="2-编程步骤"><a href="#2-编程步骤" class="headerlink" title="2.编程步骤"></a>2.编程步骤</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.引入依赖</span><br><span class="hljs-code">	 spring-aop</span><br><span class="hljs-code">	 spring-expression</span><br><span class="hljs-code">	 spring-aspects</span><br><span class="hljs-code"></span><br><span class="hljs-code"># 2.开发通知类</span><br><span class="hljs-code">	  MethodBeforeAdvice      前置通知</span><br><span class="hljs-code">	  MethodInterceptor       环绕通知</span><br><span class="hljs-code">	  AfterReturningAdvice    返回后通知</span><br><span class="hljs-code">	  ThrowsAdvice						异常通知</span><br><span class="hljs-code">	  </span><br><span class="hljs-code">	  MyAdvice implements  通知接口&#123;.....&#125;</span><br><span class="hljs-code">	  </span><br><span class="hljs-code">    //自定义通知类:用来完成额外功能</span><br><span class="hljs-code">    public class MyAdvice  implements MethodBeforeAdvice &#123;</span><br><span class="hljs-code">        @Override//参数1:当前调用的方法对象    //参数2:当前调用方法对象的参数  //参数3:目标对象</span><br><span class="hljs-code">        public void before(Method method, Object[] objects, Object o) throws Throwable &#123;</span><br><span class="hljs-code">            System.out.println(&quot;目标方法名: &quot;+method.getName());</span><br><span class="hljs-code">            System.out.println(&quot;目标方法的参数: &quot;+objects);</span><br><span class="hljs-code">            System.out.println(&quot;目标对象: &quot;+o.getClass());</span><br><span class="hljs-code">        &#125;</span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code"># 3.配置切面</span><br><span class="hljs-code">		a.引入aop命名空间</span><br><span class="hljs-code"> 			 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-code">			 &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="hljs-code">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="hljs-code">       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="hljs-code">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd </span><br><span class="hljs-code">       		                 http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br><span class="hljs-code">		b.管理通知</span><br><span class="hljs-code">			 &lt;!--管理通知类--&gt;</span><br><span class="hljs-code">    	 &lt;bean id=&quot;myAdvice&quot; class=&quot;before.MyAdvice&quot;/&gt;</span><br><span class="hljs-code">   	c.配置切面</span><br><span class="hljs-code">   		&lt;aop:config&gt;</span><br><span class="hljs-code">        &lt;aop:pointcut id=&quot;pc&quot; expression=&quot;execution(* before.UserServiceImpl.*(..))&quot;/&gt;</span><br><span class="hljs-code">        &lt;aop:advisor advice-ref=&quot;myAdvice&quot; pointcut-ref=&quot;pc&quot;/&gt;</span><br><span class="hljs-code">    	&lt;/aop:config&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code"># 4.启动工厂测试</span><br><span class="hljs-code">		 		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;before/spring.xml&quot;);</span><br><span class="hljs-code">        UserService userSerivce = (UserService) context.getBean(&quot;userService&quot;);</span><br><span class="hljs-code">        System.out.println(userSerivce.getClass());</span><br><span class="hljs-code">        userSerivce.save(&quot;小黑&quot;);</span><br></code></pre></td></tr></table></figure>
<h3 id="3-前置通知的使用"><a href="#3-前置通知的使用" class="headerlink" title="3.前置通知的使用"></a>3.前置通知的使用</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707200816006.png" alt="image-20190707200816006"></p>
<h3 id="4-环绕通知的使用"><a href="#4-环绕通知的使用" class="headerlink" title="4.环绕通知的使用"></a>4.环绕通知的使用</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707200853005.png" alt="image-20190707200853005"></p>
<h3 id="5-返回后通知"><a href="#5-返回后通知" class="headerlink" title="5.返回后通知"></a>5.返回后通知</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707200929351.png" alt="image-20190707200929351"></p>
<h3 id="6-异常通知"><a href="#6-异常通知" class="headerlink" title="6.异常通知"></a>6.异常通知</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707200958264.png" alt="image-20190707200958264"></p>
<hr>
<h2 id="6-切入点表达表"><a href="#6-切入点表达表" class="headerlink" title="6.切入点表达表"></a>6.切入点表达表</h2><h3 id="1-execution方法级别的切入点表达式"><a href="#1-execution方法级别的切入点表达式" class="headerlink" title="1.execution方法级别的切入点表达式"></a>1.execution方法级别的切入点表达式</h3><p><img src="https://qingcheng333.oss-cn-beijing.aliyuncs.com/Spring_day2.assets/image-20190707201154365.png" alt="image-20190707201154365"></p>
<blockquote>
<p><code>注意:方法级别的切入点表达式尽可能精准,否则程序运行可能出现异常</code></p>
</blockquote>
<h3 id="2-within类级别的切入点表达式"><a href="#2-within类级别的切入点表达式" class="headerlink" title="2.within类级别的切入点表达式"></a>2.within类级别的切入点表达式</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.语法</span><br><span class="hljs-code">	within(包.类)</span><br><span class="hljs-code"></span><br><span class="hljs-code"># 2.示例</span><br><span class="hljs-code">	within(com.baizhi.service.*) </span><br><span class="hljs-code">			包: com.baizhi.service</span><br><span class="hljs-code">			类: 所有类中所有方法不关心返回值和参数</span><br><span class="hljs-code">	</span><br><span class="hljs-code">	within(com.baizhi.service.UserServiceImpl)</span><br><span class="hljs-code">			包: com.baizhi.service</span><br><span class="hljs-code">			类: UserServiceImpl类中所有方法不关心返回值和参数</span><br></code></pre></td></tr></table></figure>
<hr>
<blockquote>
<p><code>注意:within的效率高于execution表达式,推荐使用within表达式</code></p>
</blockquote>

    </div>
</div>
<style>
    #noneimg img {
        display: none;
        z-index: 109;
        width: 600px !important;
        border-radius: 0px;
        position: fixed;
        box-shadow: 0 0 0px #c3c3c300 !important;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: auto !important;
    }

    @media screen and (max-width:600px) {
        #noneimg img {
            width: 88%
        }
    }
</style>
<script>
    $(function () { $('#article').click(function (e) { if (e.target.tagName == "IMG") { if ($('#nonediv').length == 0) { let MImg = `<div id='noneimg'><img src='${e.target.currentSrc}'></div>`; let MDiv = "<div id='nonediv' style='cursor: pointer;display: none; position: fixed;left: 0;top: 0; right: 0;bottom: 0;background-color: #333;opacity:0.3;z-index: 108;'></div>"; $('#article').append(MDiv); $('#article').append(MImg); $("#nonediv").fadeIn("slow"); $("#noneimg img").fadeIn("slow") } } else { if ($('#nonediv').length !== 0) { $("#noneimg ").fadeOut("slow"); $("#nonediv").fadeOut("slow"); setTimeout(function () { $('#nonediv').remove(); $('#noneimg').remove() }, 500) } } }); $('.article-content').addClass('content-move') });
</script>
<div class="Last-Next">
    
    <a href="/2020/04/10/Spring_day1/">
        <div class="last">
            <span>上一篇</span>
            <p>Spring(一)</p>
        </div>
    </a>
    

    
    <a href="/2020/04/10/Spring_day3/">
        <div class="next">
            <span>下一篇</span>
            <p>Spring(三)</p>
        </div>
    </a>
    
</div>
		
<link rel="stylesheet" href="/css/food.css">

<div class="footer">
	<div class="Copyright">
		©2021 By CHENHUAYI
	</div>
	<div class="contact">
		
		<a target="_blank" rel="noopener" href="https://github.com/yichen199709">
			<img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quiet主题">
		</a>
		
	</div>
</div>

<script src="/js/jquery.min.js"></script>


<script src="/js/gotop.js"></script>


<style type="text/css">
    @media screen and (min-width: 600px) {
        .goTop>span {
            display: block;
            border-radius: 50%;
            width: 66px;
            height: 66px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(18, 24, 58, 0.06);
            text-align: center;
            border: 1px solid rgba(18, 24, 58, 0.06);

            transition: border .5s;
            -moz-transition: border .5s;
            /* Firefox 4 */
            -webkit-transition: border .5s;
            /* Safari 和 Chrome */
            -o-transition: border .5s;
            /* Opera */
        }

        .goTop>span:hover {
            border: 1px solid #6680B3;
        }


        .goTop {
            position: fixed;
            right: 30px;
            bottom: 80px;
        }

        .goTop>span>svg {
            width: 30px;
            height: 30px;
            margin-top: 17.5px;
            opacity: 0.7;
        }

    }

    @media screen and (max-width: 600px) {
        .goTop {
            display: none;
        }
    }
</style>
<div class="goTop" id="js-go_top">
    <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g>
                <path d="M13 12v8h-2v-8H4l8-8 8 8z"></path>
            </g>
        </svg>
    </span>
</div>
<script>
    $('#js-go_top').gotoTop({ offset: 500, speed: 300, animationShow: { 'transform': 'translate(0,0)', 'transition': 'transform .5s ease-in-out' }, animationHide: { 'transform': 'translate(100px,0)', 'transition': 'transform .5s ease-in-out' } });
</script>
<script>
	console.log('\n %c 爱你的老陈 %c ', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
</script>
	</body>

</html>